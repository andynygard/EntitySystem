CREATE TABLE [Entity] (
	"Id"	integer PRIMARY KEY AUTOINCREMENT NOT NULL
);

CREATE TABLE [EntityTemplate] (
	"Id"		integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	"EntityId"	integer NOT NULL REFERENCES [Entity]([Id]) ON DELETE CASCADE,
	"Name"		varchar(50) NOT NULL
);

CREATE UNIQUE INDEX [UX_EntityTemplate]
ON [EntityTemplate]
([EntityId]);

CREATE TABLE [Component] (
	"Id"		integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	"Classname"	varchar(250) NOT NULL
);

CREATE TABLE [EntityComponent] (
	"Id"			integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	"EntityId"		integer NOT NULL REFERENCES [Entity]([Id]) ON DELETE CASCADE,
	"ComponentId"	integer NOT NULL REFERENCES [Component]([Id]) ON DELETE CASCADE
);

CREATE UNIQUE INDEX [UX_EntityComponent]
ON [EntityComponent]
([EntityId], [ComponentId]);

CREATE TABLE [Array] (
	"Id"			integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	"Length"		integer NOT NULL,
	"DataType"		varchar(250) NOT NULL
);

CREATE TABLE [ArrayData] (
	"ArrayId"		integer NOT NULL REFERENCES [Array]([Id]) ON DELETE CASCADE,
	"Index"			integer NOT NULL,
	"Value"			varchar,
    PRIMARY KEY ([ArrayId], [Index])
);

CREATE TABLE [EntityComponent_Data] (
	"EntityComponentId"	integer NOT NULL REFERENCES [EntityComponent]([Id]) ON DELETE CASCADE,
	"Property"			varchar(50) NOT NULL,
	"Value"				varchar,
	"DataType"			varchar(250) NOT NULL,
    PRIMARY KEY ([EntityComponentId], [Property])
);

CREATE TABLE [EntityComponent_Array] (
	"EntityComponentId"	integer NOT NULL REFERENCES [EntityComponent]([Id]) ON DELETE CASCADE,
	"Property"			varchar(50) NOT NULL,
	"ArrayId"			integer NOT NULL REFERENCES [Array]([Id]) ON DELETE CASCADE,
    PRIMARY KEY ([EntityComponentId], [Property])
);

CREATE TRIGGER TX_EntityComponent_Array_Delete_Array DELETE ON EntityComponent_Array
BEGIN
	DELETE FROM
		Array
	WHERE
		Id = old.ArrayId;
END;

CREATE TABLE [Level] (
	"Id"			integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	"Number"		integer NOT NULL,
	"Name"			varchar(50) NOT NULL,
	"Description"	varchar(250) NOT NULL
);

CREATE UNIQUE INDEX [UX_Level]
ON [Level]
([Number]);

CREATE TABLE [Level_Entity] (
	"LevelId"	integer NOT NULL REFERENCES [Level]([Id]) ON DELETE CASCADE,
	"EntityId"	integer NOT NULL REFERENCES [Entity]([Id]) ON DELETE CASCADE,
    PRIMARY KEY ([LevelId], [EntityId])
);

CREATE TRIGGER TX_Level_Entity_Delete_Entity DELETE ON Level_Entity
BEGIN
	DELETE FROM
		Entity
	WHERE
		Id = old.EntityId;
END;

CREATE TABLE [SavedGame] (
	"Id"		integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	"Name"		varchar(50) NOT NULL,
	"LevelId"	integer NOT NULL REFERENCES [Level]([Id]) ON DELETE CASCADE
);

CREATE UNIQUE INDEX [UX_SavedGame]
ON [SavedGame]
([Name]);

CREATE TABLE [SavedGame_Entity] (
	"SavedGameId"	integer NOT NULL REFERENCES [SavedGame]([Id]) ON DELETE CASCADE,
	"EntityId"		integer NOT NULL REFERENCES [Entity]([Id]) ON DELETE CASCADE,
    PRIMARY KEY ([SavedGameId], [EntityId])
);

CREATE TRIGGER TX_SavedGame_Entity_Delete_Entity DELETE ON SavedGame_Entity
BEGIN
	DELETE FROM
		Entity
	WHERE
		Id = old.EntityId;
END;